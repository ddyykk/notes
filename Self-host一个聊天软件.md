---
title: 自己搭建一个聊天服务器
---
## 使用VoceChat

- VoceChat是一个开源的聊天服务器, 支持网页端, Android 和 iOS. 部署使用docker, 十分简单.
- 支持全程加密和阅后即焚.
- 免费版支持20个用户, 作为家庭内部使用完全足够.
- 服务器十分轻量化, 可以运行在非常老旧的电脑上. 例如我运行在了一台插着电源的 surface 3 上面. 这个电脑的cpu是Atom, 只有4G内存, 安装了Debian系统. 运行起来十分流畅. 然后使用frp通过一个VPS暴露在公网上. 当然也可以直接在VPS上部署VoceChat, 这样网络出问题的可能性会极大减小, 但是这样会有两个问题. 一是聊天内容属于比较敏感的隐私数据, 我不希望保存在云主机上. 二是聊天会发图片和视频之类的大文件, VPS的存储空间极其有限, 扩容也非常昂贵.
- 以后有条件的话会将服务器迁移到一个迷你主机上去.

## 安装VoceChat

- 先要在电脑上(最好是Linux)安装docker, ssh. 这些一般都有不需要赘述.
- 然后要在电脑上安装frp, 用于将服务器放到公网. 只需要复制文件到电脑上即可.
- 使用docker命令就会自动下载docker 镜像并且建立容器开始运行:
  
    ```bash
    docker run -d --restart=always \
      -p 3009:3000 \
      --name vocechat-server \
      privoce/vocechat-server:latest
    ```
    
    - 命令指定了本机的3009端口为对外开放的端口, 使用网址 `http://<本机ip>:3009/` 就可以使用. 首次使用会建立一个管理员账号并且生成邀请注册的链接和二维码. 但是目前只能在局域网内访问.
- 然后将本机的3009端口(或者其他任意端口, 在docker命令中将3009改成其他端口即可)通过frp暴露在公网即可在任意地点使用浏览器经过http协议访问. (也就是说frp代理协议要设置为http)
- 如果愿意折腾购买域名和申请https证书之类的(要备案), 也可以拥有自己的聊天服务器网址. 但是个人使用的话, 我情愿使用ip地址, 不用折腾复杂的配置. 就是浏览器可能会说这个网址不安全(因为没有https).

## VoceChat的使用

- 建立管理员账号以后可以生成注册链接和注册链接的二维码, 所有的成员可以通过这个来下载APP, 注册. 因为一般只给熟人使用, 所以没有严密的注册验证手段.
- 经过简单的注册就可以开始使用了.
- 默认在同一个服务器上所有的用户可以看见所有人, 可以设置为互相不可见, 只有知道用户名才可以查找添加好友来开始聊天.
- 服务器重启以后不需要使用原来的命令, 那个命令是第一次新建容器用的, 再用一次会再建一个容器. 这点和安装软件以后再次打开的方法不一样. 容器已经存在的话使用命令就可以把容器再次唤醒, 所有的聊天数据都还在.

```bash
docker start vocechat-server
```

- VoceChat的网址是https://voce.chat/, 服务器详细的设置请参阅官方文档.