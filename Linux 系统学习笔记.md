# Linux 系统学习笔记

## 基础知识

- Terminal只是处理输入输出的程序, 并不运算.
- 终端有三种模式, 字符模式, 每按一个字符就发送; 行模式, 按下回车键才发送; 屏幕模式, 进入一个虚拟的界面, 整个屏幕一起发送和更新内容. 屏幕模式只能用于有屏幕的机器, 电传打字机无法使用。屏幕模式将屏幕分成可编辑，不可编辑区并使用方向键控制光标来编辑，最后一次性全部提交处理。
- 终端中分为内部命令和外部命令，系统自带的为内部命令，单独可执行文件为外部命令。
-  Linux没有扩展名的概念。也就是说扩展名可以自己随便起，不代表任何意义，除非由其他用户或软件单独规定。
- 操作系统的启动顺序. bootloader(引导扇区内) -- kernel 内核 -- 其他 . 所有的程序进程都由内核来启动。
- 一组进程串接起来可视为一个组或一个作业(job)。
- 同步和异步执行(前台和后台)。输入命令默认为前台同步执行，如果需在后台执行，要在命令末尾加入&符号。
- `/usr`用户文件夹用来存放用户程序。
- 动态链接库的后缀名为`.so`。
- 安装包的格式为rpm和deb，可通过包管理器安装或dpkg命令安装。
- 默认的包管理器为apt。
  - 安装命令：sudo apt install <name> 
  - 删除:  sudo apt remove --purge <name>
- Ubuntu自己的包管理器是snap, 安装的文件和配置文件在 `/var/snap/`里面。
- 命令用分号分开，即可以一次输入多个命令(批处理)。尽量不要使用分号执行多个命令，用 `&&`. 这样前面的命令出错，后面的就不会停止。
- `.`代表当前目录。`..`代表上一级目录。`~`代表home目录。`/`代表根目录。
-  Linux下的转义符为正斜杠 `\`即为windows上的路径分隔符。
- 可以直接给临时变量赋值. 这些变量关机后会丢失，在使用变量时要加 `$` 符号。`pp=908`, 使用时 `echo $pp`. 这种直接定义的变量只是局部变量，子进程无法访问. 要访问就要export导出为全局变量，则所有用户都可以访问。
- 系统设置存放在 `/etc/profile/ `. 用户设置存放在 `~/.profile`. 命令行工具的设置存放在 `~/.bashrc`
- 几个常用的系统变量。终端的类型 `$TERM`. 多个系统目录 `$PATH`.  当前用户的文件夹。`$HOME`. 当前语言。`$LANG`.  产生一个随机数。`$RANDOM`. 系统的时区。系统所在的时区。`$TZ`.  用户ID。`$UID`. 命令提示符的格式。`$PS1`.
- 在图形界面中 `sudo init 3` 则关闭图形界面. ` sudo init 5`进入图形界面。

## Linux的安装

- 有些电脑不能直接从U盘启动安装, 要启用旧的启动模式(Legacy mode)才行, 有些要关掉安全启动功能才行.(例如Surface和某些品牌机)
- 发行版可以直接装在U盘里面。从U盘启动以后用图形界面安装。
-  WSL的安装参考官方文档。

## 常用命令

- `ls` (list)当前文件夹内容。可以加路径显示某个文件夹内容。`-a`参数可显示隐藏文件。`-l`参数可以显示更多信息。`ls -a -l`在很多时候可以简化为`ll`。
  - `ls -l`显示出前面10个字符为权限。例如: `-rwxr-xr--`以三个为一组一共9个，第1位为文件属性。`d`就是文件夹。`l`就是链接或者快捷方式。后面三个显示的为创建者，中间三个为创建者的同一用户组, 最后三个为其他用户。
  - 改变权限: `chmod`. 第1组用户代号为u(user)第2组为g(group)，第3组为o(other)。
  - 例如给第1组用户加读写和执行权限。`chmod u+rxw <文件名>`; 给第2组减去权限的命令: `chmod g-rw <文件名>`.依此类推。如果省略用户的话，默认就是给文件所有者的用户更改权限。
  - 常用的给某一个文件加上执行权限(往往是脚本文件)。`chmod +x <file>`
- 改变文件的所有者。`chown <目标用户名或者ID> <文件名>`
- 改变文件的用户组。`chgrp <目标用户名或者ID> <文件名>`
- 当前路径。`pwd`
- 显示文件内容。`cat` 参数`-b`, 显示行号。如果不加任何文件路径就会自动回显输入的内容。
- 回到上一级文件夹。`cd ..`  后退到上一个访问的目录`cd -`
- 输入的内容不可见。`Ctrl+s`  重新显示输入的内容`Crtl+q`
- 为某个命令设置别名, 用来简化输入`alias <命令> = '别名'`
- 历史命令`<上箭头>`
- 显示进程树 `pstree` 参数`-p`显示进程编号(uid)。
- 关闭当前进程`Crtl+c`
- 退出某个进程`kill <进程编号>` 强制退出 `killall -SIGKILL`. kill后面需要加进程编号。killall后面需要加的是进程名称，所以不防重名。
- 暂停进程`kill -TSTP <pid>`
- 强制暂停进程 `kill -STOP <pid>`
- 继续进程 `kill -cont <pid>`
- 前台进程转后台并暂停 `Crtl+z` 后台进程继续运行 `bg %<job>` 后台进程转前台进程 `fg`
- 显示后台进程`jobs`
- 查看环境变量 `env`
- 设置环境变量(关机失效) `export <名称>=<值>` 不可以设置重名变量(重名会覆盖原先的设置)
- 复制`cp <source> <destination>` 移动 `mv <source> <destination>`如果两个路径一样，但是文件名不一样，就是重命名。
- 删除 `rm <file>` `-r`参数用来删除目录。这种方式只是标记为空白，并不实际擦除。如果要实际擦除 `shred <file>`
- 新建文件夹 `mkdir <name>`. 命名时可使用变量。{1..10}意思就是建立从1到第10共10个文件夹。或者使用{a..z}/{1..10}他们的组合。`-p` 建立一整条路径，包括子目录。`-m` 可以赋予不同的权限。注意大括号里面只能使用两个点。
- 删除文件夹` rmdir`. 同样可以使用上面的大括号里面的变量。
- 在命令的结果中查找 `<命令> | grep "keyword"`在前面命令输出中查找关键字并返回所在的行。
- 显示所有监听的网络端口 `netstat -an | grep "LISTENING"` . `netstat`命令用来显示网络状况。类似的命令还有`ss`, 可以用来查看端口信息常用的参数为: `-n` 不解析服务名称只显示端口号。`-l` 显示监听。`-t`仅显示TCP。`-u` 仅显示udp。`-p` 显示使用端口的进程。
- 显示CPU信息。`cat /proc/cpuinfo`. 显示内存信息。`cat /proc/meminfo`
-  PCI总线的设备信息, 网卡声卡，显卡等。`lspci` .  USB总线的信息。`lsusb`
- 获取管理员权限(切换当前用户为管理员) `sudo -i`,然后输入密码。如果要退出管理员 `Crtl+d`
- 远程登录其他Linux主机 `ssh -i <private key> <host name>@<address>`, 如果不需要使用密钥就去掉参数 `-i <private key>`，只写主机&地址，用密码登录即可。默认端口22。可使用参数`-P <端口号>`来更改登录的默认端口(在已知服务器端默认端口被更改的情况下)。
  - 生成新的密钥对 ` ssh -keygen -t rsa` . rsa为指定的加密方式。
  - 将自己的公钥写入远程主机的已授权客户端中 `ssh-copy-id <host>@<address>`
- 显示所有已安装的包`dpkg -l`, 或者 `sudo apt list --installed`
- 显示所有进程`ps -e`参数 `-f` 为显示所有信息。
- 退出登录 `Crtl+d`或者 `exit`, `logout`都可以。
- 清除屏幕 `Crtl+l`或者` clear`
- 移除不再需要的软件包 `sudo apt autoremove`
- 查找程序的位置 ` which <程序>` . 也可以使用` command -v <程序>` 或者 `type <程序>`
- 查询内核的版本 `uname -r` 命令本身是用来显示系统信息的。可以使用参数 `-a`来查看所有。常见的参数还有 `-m` 硬件信息， `  -p`处理器信息,  `-i`硬件平台，`-o`操作系统。
- 查找文件的位置 `whereis <文件>`
- 磁盘剩余空间 `df`. `-k`用KB为单位, `-h`使用更易读的格式, `-a`显示所有文件系统。查看内存情况`free`. 查看系统运行状况, 类似于资源管理器` htop`, 如果一些老机器或者精简过的机器没有此命令则用` top`.
- 读取并执行文件中的命令。`source <file>`. 可省略为点`.`。
- 常见的文件编辑器` nano`. 在里面编辑完以后保存`Crtl+o` 然后重命名，无需重命名直接回车。退出`Crtl+x`。
- 常见命令的说明书 `man <命令>`
- 测试某个地址的路由` traceroute <address>`
- 端口扫描器。`nmap <address>`
- 修改当前用户的密码 ` passwd`. 显示当前用户的用户名 ` whoami`
- 显示当前已登录这台电脑的所有用户` users`/ `who`/`w`
- 重启 `sudo init 6`/`reboot`. 安全关闭 ` shutdown`/ `poweroff`
- 统计文件的行数 词数和字节数, 可跟多个文件。` wc <file>`
- 将文件在屏幕上打印出来，但是对阅读进行优化，加入自动间距和换行等。`pr <file>`
- 登录FTP主机进行上传下载。`ftp <server address>`
- 查看文件类型和文件编码。`file <file>`
- 创建一个新的空白文件，如果文件已存在，则改变文件的最后修改时间。`touch <file>`
- 查看系统上挂载的所有磁盘。`mount`
- 查看文件的信息。`stat <file>`
- 域名和地址的互相查找。`host <address>`
- 查找文件。`find`. 例如要从根目录下查找名为<XX>的所有文件并包含子目录。`fine / -name xx`
- 建立到某一个文件的软链接。并且此链接不存在。`ln -s <source> <link>`
- 将光标移动到行首。`Crtl+a`/`home` . 将光标移动到行尾。`Crtl+e`/`end`
- 光标以词为单位移动。`Alt+f`, `Alt+b`
- 显示命令历史。` history` . 在历史命令中搜索 `Crtl+r`. 退出搜索。` Crtl+g`
- 以系统管理员权限执行上一个命令。`sudo !!`, 也就是说 `!!` 就是执行上一个命令。
- 从当前光标剪切至行尾。` Crtl+k`. 从当前光标剪切至行首。`Crtl+u`.  粘贴 `Crtl+y`.
- 进入编辑缓冲区, 可以写入多行命令，保存退出即可执行，会调用默认的编辑器。$EDITOR. ` Crtl+x+e`. 常见的默认编辑器有vim和nano。
- 路由持续追踪一个地址，可以探测链路的节点。` mtr <address>`
- 在本地和远程主机之间传文件。需要使用ssh(命令里面的主机必须是可以进行ssh连接的)。` scp <source> <host>:<path>` . 如果远程路径里面也包含了文件名，就可以在复制的过程中重命名. `-r` 参数复制整个目录。把源和目标调换也可从远程复制到本地。`-P` (大写) 可以指定端口。`-C` (大写) 可以在复制的过程中启用压缩。
- 使用`rsync`传文件, 两台机器都要安装。Ubuntu默认包含这个软件。`rsync -a <source> <host>:<path>`. 参数 `-r` 表示复制文件夹。使用这个命令复制文件到远程机器，默认会跳过重复的文件，而scp不会，这个软件也要使用ssh。
- 添加新用户, 需要root权限。`adduser <name>`
- 测试系统的性能。要使用snap安装。`unixbench`
- 查找占用80端口的进程。`lsof -i tcp:80`
- 查看系统服务的状态。`service <service> status`. 重启某个系统服务。` sudo service network-manager restart` 
- 查看所有服务。`service --status-all`
- 列出所有硬件。`lshw` 列出所有模块。`lsmod`
- 在比较新的系统上，system control ( systemctl ) 已经取代了service命令。启动, 停止和重启服务: ` systemctl start/stop/restart/status <service>`. 如果只输入命令不带参数，会列出系统运行的设备,组件和服务。
- 显示目录占用的空间。`du -sh <path>`. 如果要查看子目录。` du -h --max-depth=<想要查看的层数> <path>`. 以上命令中层数为子目录的层数。如果设为0就只看目录本身。`--max-depth`参数的简化形式是 `-d`。以上命令可以简化为 `du -hd <层数> <path>`
- 如果要查看文件大小 `ls -htla`
- 查看系统服务的日志 `sudo journalctl -fu <service>`
- 关闭蓝牙。`bluetoothctl power off`. 需要安装。
- 挂载一个设备文件到指定的路径。`mount <device> <path>`. 先使用 `sudo fdisk -l` 命令查看磁盘设备信息以及分区名称，然后再挂载到指定目录。要查看已存在的挂载, ` mount -l`. 或者直接查看 `/etc/mtab`文件。
  - 挂载的流程为首先插入磁盘，然后 `fdisk -l ` 查看磁盘地址。然后使用 `mount` 挂载。要移除挂载用 `umount <path>`.
- 重启控制台, 乱码的时候使用。`reset`
- 显示一个软件包是否安装等信息。`apt show <package>`. 查看软件包安装位置。`dpkg -L <package>`
- 使用命令行时内容太多可以在末尾加上 `|more` 或者 `|less` 用来分屏。

- wget 默认下载到当前目录, 可以输入多个地址用空格隔开. 要制定输出目录要用 -O 参数.

###  nmcli 命令(Network-manager command line interface)

- 跟网络用相关的可以全部用此命令。
- 还有一个nmtui提供了一个图形界面。
- 显示目前的网络状况。`nmcli general status` 或者 `nmcli dev status`
- 显示存在过的连接。`nmcli connection show`

##   Linux下用GCC编译C语言单个文件

- 命令是 `gcc -o <输出可执行文件名> <代码文件>`

## 注意事项

- 远程控制服务器时, 本机的程序过多会引起网络阻塞, 现象看起来像是服务器不定时卡死. ping 的时候每隔几秒就会出现巨大的延迟.